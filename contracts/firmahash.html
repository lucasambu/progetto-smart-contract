<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Firma Hash con MetaMask</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
</head>
<body>
  <h1>Firma un hash con MetaMask</h1>
  <input type="text" id="inputHash" placeholder="Inserisci il messaggio/hash">
  <button onclick="firmaHash()">Firma</button>

  <pre id="output"></pre>

  <script>
    async function firmaHash() {
      const hash = document.getElementById("inputHash").value;
      if (!window.ethereum) return alert("MetaMask non rilevato");

      const web3 = new Web3(window.ethereum);
      await ethereum.request({ method: 'eth_requestAccounts' });

      const accounts = await web3.eth.getAccounts();
      const digest = web3.utils.soliditySha3(hash);
      const signature = await ethereum.request({
        method: "personal_sign",
        params: [digest, accounts[0]]
      });

      document.getElementById("output").textContent = 
        "Hash: " + hash + "\n" +
        "Digest: " + digest + "\n" +
        "Firma: " + signature;
    }
  </script>
</body>
</html>